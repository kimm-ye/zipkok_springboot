<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>로그인</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" th:href="@{/css/joinmember.css}">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
</head>
<body>
<script>
    window.Kakao.init('fd6202fdf742e1c361e44f8a65bdba05');
    console.log(Kakao.isInitialized());

    function kakaoLogin() {
        Kakao.Auth.login({
            success: function (response) {
                Kakao.API.request({
                    url: '/v2/user/me',
                    success: function (response) {
                        const email = response.kakao_account.email;
                        const name = response.properties.nickname;
                        $('#kakaoemail').val(email);
                        $('#kakaoname').val(name);
                        document.loginForm.submit();
                    },
                    fail: function (error) {
                        console.log(error);
                    }
                });
            },
            fail: function (error) {
                console.log(error);
            }
        });
    }
</script>

<div class="container">
    <div id="header">
        <h1 class="login_title"><label for="email">로그인</label></h1>
        <h3>Welcome! 집콕에 오신 것을 환영합니다.</h3>
    </div>

    <div id="wrapper">
        <div id="content">

            <!-- 로그인되지 않은 경우 -->
            <th:block th:if="${session.siteUserInfo == null}">
                <form name="loginForm" method="post" th:action="@{/member/login}" onsubmit="return validateForm(this);">
                    <input type="hidden" name="login_ok" value="1"/>
                    <input type="hidden" name="backUrl" th:value="${param.backUrl}"/>

                    <div>
                        <h3 class="join_title"><label for="id">아이디</label></h3>
                        <span class="box int_id">
                            <input type="text" id="id" class="join_H" maxlength="30" name="id" required>
                        </span>

                        <h3 class="join_title"><label for="pass">비밀번호</label></h3>
                        <span class="box int_pass">
                            <input type="password" id="pass" class="join_H" maxlength="16" name="pass" required>
                            <span id="alertTxt">사용불가</span>
                            <img th:src="@{/img/login/m_icon_pass.png}" id="pass1_img" class="passImg">
                        </span>

                        <span style="font-size:1.5em; color:red;" th:text="${LoginNG}"></span>

                        <div class="btn_area">
                            <p style="text-align: right;"><a th:href="@{/member/find}">아이디/비밀번호 찾기</a></p>
                            <input type="submit" class="loginBtn" value="로그인">
                            <br><br>
                            <button type="button" class="joinBtn" th:onclick="'location.href=\'/zipkok/member/join\''">
                                <span>회원가입</span>
                            </button>
                            <br><br>
                            <div>-------------------------- 또는 --------------------------</div>
                            <br>
                            <div id="kakaologin">
                                <div class="kakaobtn">
                                    <input type="hidden" name="kakaoemail" id="kakaoemail" value=""/>
                                    <input type="hidden" name="kakaoname" id="kakaoname" value=""/>
                                    <a href="javascript:kakaoLogin();">
                                        <img th:src="@{/img/login/kakao_login_medium_wide.png}" style="width: 100%;"/>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </th:block>

            <!-- 로그인된 경우 -->
            <th:block th:if="${session.siteUserInfo != null}">
                <div style="text-align: center;">
                    <h4><b th:text="${session.siteUserInfo.member_name}"></b>님 어서오세요!</h4>
                    <br><br>
                    <button class="btn btn-success" th:onclick="'location.href=\'/zipkok/member/mypage\''">마이페이지</button>
                    <button class="btn btn-danger" th:onclick="'location.href=\'/zipkok/member/logout\''">로그아웃</button>
                    <button class="btn btn-primary" th:onclick="'location.href=\'/zipkok\''">메인으로</button>
                </div>
            </th:block>

        </div>
    </div>
</div>
</body>
</html>