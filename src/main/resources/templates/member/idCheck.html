<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>ID Check</title>
    <script>
        // 팝업창이 닫힐 때 부모창 상태 복원
        window.onbeforeunload = function() {
            if (opener && opener.document && opener.document.joinForm) {
                opener.document.joinForm.idDuplication.value = "";
                opener.document.joinForm.member_id.readOnly = false;
            }
        }

        function idUse(userid) {
            // 정상적인 사용이므로 onbeforeunload 이벤트 비활성화
            window.onbeforeunload = null;

            opener.document.joinForm.idDuplication.value = "idCheck";
            opener.document.joinForm.member_id.value = userid;
            self.close();
        }

        function validateForm(form) {
            if (form.member_id.value === '') {
                alert('아이디를 입력해주세요');
                form.member_id.focus();
                return false;
            }

            if (!(form.member_id.value.length >= 4 && form.member_id.value.length <= 12)) {
                alert("4자 이상 12자 이내의 값만 입력하세요");
                form.member_id.value = '';
                form.member_id.focus();
                return false;
            }

            var whatType = form.member_id.value;
            for (var i = 0; i < whatType.length; i++) {
                if (!((whatType[i] >= 'a' && whatType[i] <= 'z') ||
                      (whatType[i] >= 'A' && whatType[i] <= 'Z') ||
                      (whatType[i] >= '0' && whatType[i] <= '9'))) {
                    alert("아이디는 숫자랑 영문자만 입력가능합니다");
                    form.member_id.value = '';
                    form.member_id.focus();
                    return false;
                }
            }
            return true;
        }
    </script>
</head>
<body>
    <div th:if="${idCheckResult}">
        <div id="member_checkId">
            <fieldset>
                <div align="center">
                    <h2 th:text="'[' + ${id} + ']는 사용중인 아이디 입니다.'"></h2>
                    <h2>새로운 아이디를 입력해주세요.</h2>
                    <form name="overlapFrm" th:action="@{/member/join/check}" method="post" onsubmit="return validateForm(this)">
                        <input type="text" name="id" size="20"/>
                        <input type="submit" value="중복확인"/>
                    </form>
                </div>
                <ul style="color:#757575; list-style: none; font-size: 13px">
                    <li>공백 또는 특수문자가 포함된 아이디는 사용할 수 없습니다.</li>
                    <li>숫자로 시작하거나, 숫자로만 이루어진 아이디는 사용할 수 없습니다.</li>
                </ul>
            </fieldset>
        </div>
    </div>
    <div th:if="${!idCheckResult}">
        <fieldset>
            <div align="center">
                <h2 th:text="'[' + ${id} + ']는 사용 가능한 아이디 입니다.'"></h2>
                <button type="button" th:data-id="${id}" onclick="idUse(this.dataset.id);">아이디 사용</button>
            </div>
        </fieldset>
    </div>
</body>
</html>