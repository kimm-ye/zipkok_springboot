<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//com.kosmo.zipkok.mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kosmo.zipkok.dao.MemberDAO">
	
	<select id="selectEmail" parameterType="java.lang.String" resultType="boolean">
		SELECT
		    CASE
				WHEN COUNT(MEMBER_SEQ) > 0 THEN 1
			ELSE 0
			END AS exists_flag
		FROM
		    MEMBER
		WHERE
		    MEMBER_EMAIL = #{member_email}
	</select>

	<select id="selectMemberById" parameterType="java.lang.String" resultType="HelperDTO">
		SELECT
			M.member_seq AS memberSeq,
			M.member_id AS memberId,
			M.member_pass AS memberPass,
			M.member_name AS memberName,
			M.member_email AS memberEmail,
			M.member_age AS memberAge,
			M.member_gender AS memberGender,
			M.member_phone AS memberPhone,
			NVL(M.member_missionN, 0) AS memberMissionN,
			M.member_status AS memberStatus,
			H.member_bank AS memberBank,
			H.member_account AS memberAccount,
			H.member_vehicle AS memberVehicle,
			H.member_introduce AS memberIntroduce,
			H.member_review AS memberReview,
			NVL(H.member_missionC, 0) AS memberMissionC,
			NVL(H.member_point, 0) AS memberPoint,
			IMG.image_name AS imageFileName,
			IMG.image_etx AS imageFileEtx,
			IMG.image_file AS imageFile
		FROM
			MEMBER M
		LEFT JOIN HELPER H
		ON M.member_seq = H.member_seq
		LEFT JOIN HELPER_IMAGE IMG
		ON H.member_seq = IMG.member_seq
		WHERE
		    MEMBER_ID =#{memberId}
	</select>


	<select id="idCheck" resultType="java.lang.String">
		SELECT
			member_id AS memberId
		FROM
			member
		WHERE
			member_id = #{memberId}
	</select>

	<select id="findId" parameterType="Map" resultType="java.lang.String">
		SELECT
			member_id AS memberId
		FROM
			member
		WHERE
			member_name = #{name}
		AND member_email = #{email}
	</select>

	<select id="findPwd" parameterType="Map" resultType="java.lang.String">
		SELECT
			member_pass AS memberPass
		FROM
			member
		WHERE
			member_id = #{mid}
		AND member_name = #{name}
		AND member_email = #{email}
	</select>

	<!-- 사용자 등록 -->
	<insert id="insertMember" parameterType="HelperDTO" useGeneratedKeys="true" keyProperty="memberSeq">
		INSERT INTO MEMBER
		    (
		    	MEMBER_ID,
		     	MEMBER_PASS,
		     	MEMBER_NAME,
		     	MEMBER_EMAIL,
		     	MEMBER_AGE,
		     	MEMBER_GENDER,
		     	MEMBER_PHONE,
		     	MEMBER_STATUS
			)
		VALUES
		    (
				#{memberId},
		    	#{memberPass},
		    	#{memberName},
		    	#{memberEmail},
				#{memberAge},
		    	#{memberGender},
				#{memberPhone},
				#{memberStatus}
			)
	</insert>

	<!-- 헬퍼 등록-->
	<insert id="insertHelper" parameterType="HelperDTO">
		INSERT INTO HELPER
			(
			 	MEMBER_SEQ,
				MEMBER_BANK,
			 	MEMBER_ACCOUNT,
			 	MEMBER_VEHICLE,
				MEMBER_INTRODUCE
			)
		VALUES
		    (
		     	#{memberSeq},
				#{memberBank},
		    	#{memberAccount},
		    	#{memberVehicle},
				#{memberIntroduce}
			)
	</insert>

	<insert id="insertHelperImage" parameterType="HelperDTO">
		INSERT INTO HELPER_IMAGE
			(
				MEMBER_SEQ,
				IMAGE_NAME,
			 	IMAGE_ETX,
				IMAGE_FILE,
				CREATE_DT
			)
		VALUES
			(
				#{memberSeq},
				#{imageFileName},
				#{imageFileEtx},
				#{imageFile},
				NOW()
			)
	</insert>
	

	<!-- 정보수정 조회 -->
	<select id="getMemberInfo" resultType="com.kosmo.zipkok.dto.MemberDTO">
		SELECT * FROM member WHERE member_id=#{0}
	</select>
	
	<!-- 정보수정 (헬퍼) -->
<!--	<update id="helperMyPage">
		UPDATE member
			SET member_email=#{member_email}, member_age=#{member_age}, member_pass=#{member_pass}, member_phone=#{member_phone},	
				member_bank=#{member_bank}, member_account=#{member_account}, member_vehicle=#{member_vehicle}, 
				member_introduce=#{member_introduce}
				<if test="member_ofile != null and member_sfile !=null">
					, member_ofile=#{member_ofile}, member_sfile=#{member_sfile}
				</if>
			
				
			WHERE member_id=#{member_id} AND member_status=#{member_status}
	</update>
	-->
	<!-- 정보수정 (사용자) -->
	<update id="userMyPage">
		UPDATE member
			SET member_email=#{member_email}, member_pass=#{member_pass}
				, member_age=#{member_age}, member_phone=#{member_phone}
			
			WHERE member_id=#{member_id} AND member_status=#{member_status}
	</update>
	
	<!-- 카카오로그인시 가입여부 -->
	<select id="kakaoLogin" resultType="com.kosmo.zipkok.dto.MemberDTO">
		SELECT * FROM member WHERE member_id=#{0}
	</select>
	
	<!-- 회원탈퇴 -->
	<delete id="memberDelete" >
		DELETE FROM member
			WHERE member_id=#{param1} 
	</delete>

</mapper>

